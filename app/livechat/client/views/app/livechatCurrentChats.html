<template name="livechatCurrentChats">
	{{#requiresPermission 'view-livechat-manager'}}
		<fieldset>
			<form class="form-inline" method="post">
				<div class="form-group">
					<label for="name">{{_ "Name"}}</label>
					<input type="text" class="rc-input__element" name="name">
				</div>
				<div class="form-group">
					{{> SearchSelect
						onClickTag=onClickTagAgent
						list=selectedAgents
						onSelect=onSelectAgents
						collection='UserAndRoom'
						subscription='userAutocomplete'
						field='username'
						sort='username'
						label="Served_By"
						placeholder="Served_By"
						name="agent"
						icon="at"
						noMatchTemplate="userSearchEmpty"
						templateItem="popupList_item_default"
						modifier=agentModifier
					}}
				</div>
				<div class="form-group">
					<div class="rc-select">
						<select class="rc-select__element" name="status">
							<option class="rc-select__option" value="">{{_ "All"}}</option>
							<option class="rc-select__option" value="opened">{{_ "Opened"}}</option>
							<option class="rc-select__option" value="closed">{{_ "Closed"}}</option>
						</select>
						{{> icon block="rc-select__arrow" icon="arrow-down" }}
					</div>
				</div>
				<div class="form-group input-daterange">
					<span class="input-group-addon">{{_ "Date_From"}}</span>
					<input autocomplete="off" type="text" class="form-control rc-input__element" id="from" name="from" >
						<span class="input-group-addon">{{_ "Date_to"}}</span>
					<input autocomplete="off" type="text" class="form-control rc-input__element" id="to" name="to">
				</div>
				<div class="form-group">
					<button class="rc-button rc-button--primary">{{_ "Filter"}}</button>
				</div>
			</form>
		</fieldset>
		<div class="rc-table-content">
			{{#table fixed='true' onScroll=onTableScroll onResize=onTableResize onSort=onTableSort}}
				<thead>
					<tr>
						<th width="25%">
							<div class="table-fake-th">{{_ "Name"}}</div>
						</th>
						<th width="25%">
							<div class="table-fake-th">{{_ "Served_By"}}</div>
						</th>
						<th width="15%">
							<div class="table-fake-th">{{_ "Started_At"}}</div>
						</th>

						<th width="15%">
							<div class="table-fake-th">{{_ "Last_Message_At"}}</div>
						</th>
						<th width="15%">
							<div class="table-fake-th">{{_ "Status"}}</div>
						</th>

						<th width="5%"><div class="table-fake-th">&nbsp;</div></th>
					</tr>
				</thead>
				<tbody>
					{{#each livechatRoom}}
						<tr class="rc-table-tr manage row-link" data-name="{{latest.name}}">

							<td>
								<div class="rc-table-wrapper">
									<div class="rc-table-info">
										<span class="rc-table-title">
											{{fname}}
										</span>
									</div>
								</div>
							</td>
							<td>{{servedBy}}</td>
							<td>{{startedAt}}</td>
							<td>{{lastMessage}}</td>
							<td>{{status}}</td>
							{{#requiresPermission 'remove-closed-livechat-rooms'}}
								{{#if isClosed}}
									<td><a href="#remove" class="remove-livechat-room"><i class="icon-trash"></i></a></td>
								{{else}}
									<td>&nbsp;</td>
								{{/if}}
							{{else}}
								<td>&nbsp;</td>
							{{/requiresPermission}}
						</tr>
					{{/each}}
					{{#unless isReady}}
						<tr class="table-no-click">
							<td class="table-loading-td">{{> loading}}</td>
						</tr>
					{{/unless}}
				</tbody>
			{{/table}}
		</div>
		<div class="text-center">
			<button class="button rc-button load-more">{{_ "Load_more"}}</button>
		</div>
	{{/requiresPermission}}
</template>

<template name="SearchSelect">
		<div class="rc-input" id='search-{{name}}' {{disabled}}>
			<label class="rc-input__label">
				<div class="rc-input__wrapper">
					{{# if icon}}
					<div class="rc-input__icon">
						{{> icon block="rc-input__icon-svg" icon=icon}}
					</div>
					{{/if}}
					<div class="rc-tags{{# unless icon}} rc-tags--no-icon{{/unless}}">
						{{#each item in list}} {{> tag item}} {{/each}}
						<input type="text" id="{{name}}" class="rc-tags__input" placeholder="{{_ placeholder}}" name="{{name}}" autocomplete="off" {{disabled}} />
					</div>
				</div>
				{{#with config}} {{#if autocomplete 'isShowing'}}
				<div class="dropdown-in">
					{{#if autocomplete 'isLoaded'}}
						{{> popupList data=config items=items}}
					{{/if}}
				</div>
				{{/if}} {{/with}}
			</label>
		</div>
	</template>
